

1.宏定义
can id
电机反馈 id
can 波特率 *
电机电流 max
min
can控制周期

2.枚举类型 枚举电机状态

3.电机控制结构体
  目标电流
  枚举类型 电机当前状态

  以下状态用于电机通信反馈
  电机在线状态*
  最后更新时间
  
  以下用于安全保护
  电流上下限幅
  急停标志

4.函数
  1.cuebex生成
     各种外设初始化
     系统时钟
  2.hal库函数
     can start
      HAL_CAN_ActivateNotification()   判断can当前状态 用一个hal库枚举类型接收
      3.HAL_CAN_AddTxMessage() 发送函数
       4.HAL_CAN_GetRxMessage() 信息接收函数*
       5.HAL_GetTick() 获取系统时间  *
       6.HAL_Delay() 
       7.HAL_CAN_ConfigFilter() 写入滤波器参数
   重定义函数
       8.HAL_CAN_RxFifo0MsgPendingCallback() *信息反馈
       9.Error_Handler()  错误处理
3.应用层函数
  1.基础配置函数
	1.CAN_Config_Init()  自定义CAN初始化函数 整合
			  1. 启动CAN控制器（HAL_CAN_Start）
   			  2. 配置接收过滤器（CAN_Filter_Config）整        合.HAL_CAN_ConfigFilter()
  			  3. 使能接收中断（HAL_CAN_ActivateNotification）
	2.CAN_Filter_Config() 滤波器配置
  2.通信类函数
	1.CAN_Send_Control_Command() 自定义数据发送函数 整合					1.HAL_CAN_AddTxMessage()
 3.电机驱动类函数
	1.M3508_Init() 自定义电机初始化函数 
			1.初始化电机结构体参数在安全状态
	2.M3508_Stop()  正常停止 重新发送数据即可启动
 	3.M3508_Emergency_Stop()  紧急停止 要调用函数才可恢复
	4.M3508_Resume_From_Stop()  紧急停止恢复
	5.M3508_Update_State()*


main()主循环
    → M3508_Set_Current()         // 应用层控制指令
        → CAN_Send_Control_Command() // 通信层打包数据
            → HAL_CAN_AddTxMessage()  // HAL库发送函数
                → CAN控制器硬件        // 最终物理发送
CAN接收中断*
    → HAL_CAN_RxFifo0MsgPendingCallback() // 中断回调
        → HAL_CAN_GetRxMessage()           // 读取数据
            → M3508_Update_State()         // 更新状态
                → 状态变量更新             // 内存操作
main()初始化段
    → HAL_Init()                    // 基础库初始化
    → SystemClock_Config()          // 时钟配置
    → MX_GPIO_Init()               // 引脚配置
    → MX_CAN1_Init()               // 外设初始化
    → CAN_Config_Init()            // 通信整体初始化
        → HAL_CAN_Start()          // 启动控制器
        → CAN_Filter_Config()      // 配置过滤器
            → HAL_CAN_ConfigFilter()
        → HAL_CAN_ActivateNotification() // 使能中断


*表示暂时不需要




